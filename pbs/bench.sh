#!/bin/bash


# arguments for running benchmarks
BENCH_BUFFER_SIZE=23
BENCH_ITERATION_COUNT=100
BENCH_MODES=Send,SendPersistent,Isend,Psend
BENCH_MIN_THREAD_COUNTS=0
BENCH_MAX_THREAD_COUNTS=4
BENCH_MIN_PARTITION_SIZES=12
BENCH_MAX_PARTITION_SIZES=23
BENCH_SEND_PATTERNS=0

# arguments for tracing
TRACE_BUFFER_SIZE=23
TRACE_ITERATION_COUNT=1
TRACE_MODES=Send,SendPersistent,Isend,Psend
TRACE_MIN_THREAD_COUNTS=0
TRACE_MAX_THREAD_COUNTS=3
TRACE_MIN_PARTITION_SIZES=15
TRACE_MAX_PARTITION_SIZES=15
TRACE_SEND_PATTERNS=0


# generates cmdline arguments to pass to benchmark executable
make_bench_args() {
	BENCH_ARGS="-b $BENCH_BUFFER_SIZE -i $BENCH_ITERATION_COUNT -m $BENCH_MODES -t $BENCH_MIN_THREAD_COUNTS -T $BENCH_MAX_THREAD_COUNTS -p $BENCH_MIN_PARTITION_SIZES -P $BENCH_MAX_PARTITION_SIZES"
	echo "$BENCH_ARGS"
}

# generates cmdline arguments to pass to benchmark executable for tracing
make_trace_args() {
	TRACE_ARGS="-b $TRACE_BUFFER_SIZE -i $TRACE_ITERATION_COUNT -m $TRACE_MODES -t $TRACE_MIN_THREAD_COUNTS -T $TRACE_MAX_THREAD_COUNTS -p $TRACE_MIN_PARTITION_SIZES -P $TRACE_MAX_PARTITION_SIZES"
	echo "$TRACE_ARGS"
}


setup() {
	NAME="$1"
	cd $PBS_O_WORKDIR

	mkdir -p results/"$NAME"/
	rm -f results/"$NAME"/*
	cd results/"$NAME"

	cat $PBS_NODE_FILE > node-file.txt
}

bin_directory() {
	echo "$PBS_O_WORKDIR/bin/"
}
